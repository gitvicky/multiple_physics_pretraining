Loading rhel8/default-amp
  Loading requirement: dot rhel8/slurm singularity/current rhel8/global
    cuda/11.4 libpciaccess/0.16/gcc-9.4.0-6fonbj6
    libiconv/1.16/gcc-9.4.0-ahebbov libxml2/2.9.12/gcc-9.4.0-gnknt5e
    ncurses/6.2/gcc-9.4.0-aiirok7 hwloc/2.5.0/gcc-9.4.0-7sqomga
    libevent/2.1.12/gcc-9.4.0-hgny7cm numactl/2.0.14/gcc-9.4.0-52dwc6n
    cuda/11.4.0/gcc-9.4.0-3hnxhjt gdrcopy/2.2/gcc-9.4.0-e4igtfp
    knem/1.1.4/gcc-9.4.0-bpbxgva libnl/3.3.0/gcc-9.4.0-whwhrwb
    rdma-core/34.0/gcc-9.4.0-5eo5n2u ucx/1.11.1/gcc-9.4.0-lktqyl4
    openmpi/4.1.1/gcc-9.4.0-epagguv
Changed directory to /home/ir-gopa2/rds/rds-ukaea-ap001/ir-gopa2/Code/multiple_physics_pretraining.

JobID: 50753479
======
Time: Mon Apr 15 20:19:18 BST 2024
Running on master node: gpu-q-2
Current directory: /home/ir-gopa2/rds/rds-ukaea-ap001/ir-gopa2/Code/multiple_physics_pretraining

Nodes allocated:
================
cat: machine.file.50753479: No such file or directory


numtasks=4, numnodes=1, mpi_tasks_per_node=4 (OMP_NUM_THREADS=1)

Executing command:
==================
python /home/ir-gopa2/rds/rds-ukaea-ap001/ir-gopa2/Code/multiple_physics_pretraining/train_basic.py --yaml_config config/mpp_avit_ti_config.yaml --config basic_config 

Initializing data on rank 0
Initializing model on rank 0
Model parameter count: 7285884
Loading checkpoint ~/MPP/basic_config/00/training_checkpoints/ckpt.tar
===========================================================================
Layer (type:depth-idx)                             Param #
===========================================================================
AViT                                               --
├─SubsampledLinear: 1-1                            624
├─hMLP_stem: 1-2                                   --
│    └─Sequential: 2-1                             --
│    │    └─Conv2d: 3-1                            36,864
│    │    └─RMSInstanceNorm2d: 3-2                 96
│    │    └─GELU: 3-3                              --
│    │    └─Conv2d: 3-4                            9,216
│    │    └─RMSInstanceNorm2d: 3-5                 96
│    │    └─GELU: 3-6                              --
│    │    └─Conv2d: 3-7                            36,864
│    │    └─RMSInstanceNorm2d: 3-8                 384
├─ModuleList: 1-3                                  --
│    └─SpaceTimeBlock: 2-2                         --
│    │    └─AxialAttentionBlock: 3-9               445,984
│    │    └─AttentionBlock: 3-10                   149,536
│    └─SpaceTimeBlock: 2-3                         --
│    │    └─AxialAttentionBlock: 3-11              445,984
│    │    └─AttentionBlock: 3-12                   149,536
│    └─SpaceTimeBlock: 2-4                         --
│    │    └─AxialAttentionBlock: 3-13              445,984
│    │    └─AttentionBlock: 3-14                   149,536
│    └─SpaceTimeBlock: 2-5                         --
│    │    └─AxialAttentionBlock: 3-15              445,984
│    │    └─AttentionBlock: 3-16                   149,536
│    └─SpaceTimeBlock: 2-6                         --
│    │    └─AxialAttentionBlock: 3-17              445,984
│    │    └─AttentionBlock: 3-18                   149,536
│    └─SpaceTimeBlock: 2-7                         --
│    │    └─AxialAttentionBlock: 3-19              445,984
│    │    └─AttentionBlock: 3-20                   149,536
│    └─SpaceTimeBlock: 2-8                         --
│    │    └─AxialAttentionBlock: 3-21              445,984
│    │    └─AttentionBlock: 3-22                   149,536
│    └─SpaceTimeBlock: 2-9                         --
│    │    └─AxialAttentionBlock: 3-23              445,984
│    │    └─AttentionBlock: 3-24                   149,536
│    └─SpaceTimeBlock: 2-10                        --
│    │    └─AxialAttentionBlock: 3-25              445,984
│    │    └─AttentionBlock: 3-26                   149,536
│    └─SpaceTimeBlock: 2-11                        --
│    │    └─AxialAttentionBlock: 3-27              445,984
│    │    └─AttentionBlock: 3-28                   149,536
│    └─SpaceTimeBlock: 2-12                        --
│    │    └─AxialAttentionBlock: 3-29              445,984
│    │    └─AttentionBlock: 3-30                   149,536
│    └─SpaceTimeBlock: 2-13                        --
│    │    └─AxialAttentionBlock: 3-31              445,984
│    │    └─AttentionBlock: 3-32                   149,536
├─hMLP_output: 1-4                                 9,228
│    └─Sequential: 2-14                            --
│    │    └─ConvTranspose2d: 3-33                  36,864
│    │    └─RMSInstanceNorm2d: 3-34                96
│    │    └─GELU: 3-35                             --
│    │    └─ConvTranspose2d: 3-36                  9,216
│    │    └─RMSInstanceNorm2d: 3-37                96
│    │    └─GELU: 3-38                             --
===========================================================================
Total params: 7,285,884
Trainable params: 7,285,884
Non-trainable params: 0
===========================================================================
Starting Training Loop...
train_loader_size 3400 68000
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Could not load library libcudnn_cnn_train.so.8. Error: /usr/local/Cluster-Apps/cudnn/8.9_cuda-11.8/lib64/libcudnn_cnn_train.so.8: undefined symbol: _ZN5cudnn3cnn5infer22queryClusterPropertiesERPhS3_, version libcudnn_cnn_infer.so.8
Traceback (most recent call last):
  File "/home/ir-gopa2/rds/rds-ukaea-ap001/ir-gopa2/Code/multiple_physics_pretraining/train_basic.py", line 552, in <module>
    trainer.train()
  File "/home/ir-gopa2/rds/rds-ukaea-ap001/ir-gopa2/Code/multiple_physics_pretraining/train_basic.py", line 446, in train
    tr_time, data_time, train_logs = self.train_one_epoch()
                                     ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ir-gopa2/rds/rds-ukaea-ap001/ir-gopa2/Code/multiple_physics_pretraining/train_basic.py", line 259, in train_one_epoch
    self.gscaler.scale(loss).backward()
  File "/home/ir-gopa2/miniconda3/envs/mpp_env/lib/python3.11/site-packages/torch/_tensor.py", line 492, in backward
    torch.autograd.backward(
  File "/home/ir-gopa2/miniconda3/envs/mpp_env/lib/python3.11/site-packages/torch/autograd/__init__.py", line 251, in backward
    Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
RuntimeError: GET was unable to find an engine to execute this computation
